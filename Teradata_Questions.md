# HCL

Skill Show Case 1								
Please build a view to show the cumulative amount, and moving average amount for each account in the reporting period of the first 6 months of 2016 								
If you have to make any assumptions on data model, business requirements and so on, please feel free to do so but clearly call them out.								
								
BALANCE table								
ACCOUNT	EFFT_D	EXPY_D	AMOUNT					
AU01234567890	2016-05-15	2016-05-31	0.00					
AU01234567890	2016-06-01	2016-06-30	5500.00					
AU01234567890	2016-07-01	9999-12-31	4012.23					
AU01234567999	2015-10-08	2015-12-08	300.00					
AU01234567999	2015-12-09	2016-01-04	1650.00					
AU01234567999	2016-01-05	2016-01-31	25680.56					
AU01234567999	2016-02-01	2016-03-03	27080.56					
AU01234567999	2016-03-04	9999-12-31	39576.56					
AU11223344556	2016-03-21	2016-04-02	568392.37					
AU11223344556	2016-04-03	2016-05-08	337820.61					
AU11223344556	2016-05-09	2016-05-18	583087.61					
AU11223344556	2016-05-19	2016-06-11	354680.32					
AU11223344556	2016-06-12	2016-08-31	456800.32					
AU11223344556	2016-09-01	9999-12-31	256708.41					



Answer :

CREATE VOLATILE TABLE VT_TEMP

    (

    ACCOUNT1 VARCHAR(100) CHARACTER SET UNICODE NOT CASESPECIFIC,

      EFFT_D DATE FORMAT 'YYYY-MM-DD',

      EXPY_D DATE FORMAT 'YYYY-MM-DD',

      AMOUNT DECIMAL(18,2)

      )PRIMARY INDEX ( ACCOUNT1 ) ON COMMIT PRESERVE ROWS;

 

INSERT INTO VT_TEMP VALUES('AU01234567890','2016-05-15','2016-05-31',0.00);

INSERT INTO VT_TEMP VALUES('AU01234567890','2016-06-01','2016-06-30',5500.00);

INSERT INTO VT_TEMP VALUES('AU01234567890','2016-07-01','9999-12-31',4012.23);

 

INSERT INTO VT_TEMP VALUES('AU01234567899','2015-10-08','2015-12-08',300.00);

INSERT INTO VT_TEMP VALUES('AU01234567899','2015-12-09','2016-01-04',1650.00);

INSERT INTO VT_TEMP VALUES('AU01234567899','2016-01-05','2016-01-31',25680.56);

INSERT INTO VT_TEMP VALUES('AU01234567899','2016-02-01','2016-03-03',27080.56);

INSERT INTO VT_TEMP VALUES('AU01234567899','2016-03-04','9999-12-01',39576.56);

 

 

INSERT INTO VT_TEMP VALUES('AU11223344556','2016-03-21','2016-04-02',568392.37);

INSERT INTO VT_TEMP VALUES('AU11223344556','2016-04-03','2016-05-08',337820.61);

INSERT INTO VT_TEMP VALUES('AU11223344556','2016-05-09','2016-05-18',583087.61);

INSERT INTO VT_TEMP VALUES('AU11223344556','2016-05-19','2016-06-11',354680.32);

INSERT INTO VT_TEMP VALUES('AU11223344556','2016-06-12','2016-08-31',456800.32);

INSERT INTO VT_TEMP VALUES('AU11223344556','2016-09-01','9999-12-31',256708.41);

 

 

SEL ACCOUNT1

,EFFT_D

,EXPY_D

,AMOUNT

, CAST ( CAST ( EFFT_D AS FORMAT 'YYYYMM' ) AS VARCHAR ( 6 ) ) AS EFFT_D_1

,CAST ( CAST ( EXPY_D AS FORMAT 'YYYYMM' ) AS VARCHAR ( 6 ) ) AS EXPY_D_1

,SUM(AMOUNT) OVER (PARTITION BY ACCOUNT1 ORDER BY EFFT_D ROWS UNBOUNDED PRECEDING )

,AVERAGE(AMOUNT) OVER (PARTITION BY ACCOUNT1 ORDER BY EFFT_D ROWS 1 PRECEDING )

FROM VT_TEMP

WHERE EXPY_D_1 <= '201606'

AND EFFT_D_1 >= '201601'



Skill Show Case 2																	
Please build a Bteq to do insert or update latest data from staging table to target table.  Target table is time variant. Please show the results.																	
If you have to make any assumptions on data model, business requirements and so on, please feel free to do so but clearly call them out.																	
Hint:  Since it is impractical to create life-like volume test data, only minimum rows of records are given here.  Please script as if you are working with hugh volume data in time variant table.																	
																	
Target table in Production																	
PROD.PRODUCT table																	
ACCOUNT	DEPT_ROLE_C	DEPT_I	EFFT_D	EXPY_D	BRCH_N	PROS_KEY_EFFT_I	PROS_KEY_EXPY_I	EROR_SEQN_I	ROW_SECU_ACCS_C	SRCE_SYST_C	RECORD_DELETED_FLAG	CTL_ID	PROCESS_NAME	PROCESS_ID	UPDATE_PROCESS_NAME	UPDATE_PROCESS_ID	RVNU_SHRE_R
AU11223344556	LDGR 	15773	2014-08-18	2014-09-18		3,793,736	3,793,736		0		0	0	NON_CTLFW                     	0			
AU29214000008	LDGR 	15675	2015-04-07	9999-12-31		4,136,084			0		0	0	NON_CTLFW                     	0			
AU29580800000	LDGR 	15775	2014-04-28	9999-12-31		3,550,822			0		0	0	NON_CTLFW                     	0			
AU53110397555	CNTR 	1422	2007-08-30	9999-12-31	3534	674,824			0		0	0	NON_CTLFW                     	0			
AU18152616666	LDGR 	346	2015-11-06	9999-12-31	2067	4,510,692			0		0	0	NON_CTLFW                     	0			
																	
Latest data extracted from source system on 15/4/2016 and loaded into staging area																	
Assume that the process_key for this load will be 4593736 																	
STAGE.PRODUCT_STAGING table																	
ACCOUNT	DEPT_ROLE_C	DEPT_I	BRCH_N														
AU13907300233	LDGR 	15773	2257														
AU29214000008	LDGR 	15660	5502														
AU29580800054	LDGR 	15775	6027														
AU53110397555	LDGR 	1422	3534														
AU18152616666	LDGR 	12346	2167														


Answer

CREATE TABLE  DB_WRK.PRODUCT  (

ACCOUNT_ID VARCHAR ( 100 )

,DEPT_ROLE_C VARCHAR ( 100 )

,DEPT_I VARCHAR ( 100 )

,EFFT_D DATE

,EXPY_D  DATE

,BRCH_N VARCHAR ( 100 )

,PROS_KEY_EFFT_I VARCHAR ( 100 )

,PROS_KEY_EXPY_I VARCHAR ( 100 )

,EROR_SEQN_I VARCHAR ( 100 )

,ROW_SECU_ACCS_C VARCHAR ( 100 )

,SRCE_SYST_C VARCHAR ( 100 )

,RECORD_DELETED_FLAG VARCHAR ( 100 )

,CTL_ID VARCHAR ( 100 )

,PROCESS_NAME VARCHAR ( 100 )

,PROCESS_ID VARCHAR ( 100 )

,UPDATE_PROCESS_NAME VARCHAR ( 100 )

,UPDATE_PROCESS_ID VARCHAR ( 100 )

,RVNU_SHRE_R VARCHAR ( 100 )

);

 

INSERT INTO DB_WRK.PRODUCT 

VALUES

( 'AU11223344556','LDGR ','15773','2014-08-18','2014-09-18',' ','3793736','3793736',' ','0', ' ','0','0','NON_CTLFW','0',' ',' ',' ' );

INSERT INTO DB_WRK.PRODUCT 

VALUES

(

'AU29214000008','LDGR ','15675','2015-04-07','9999-12-31', '','4136084',' ',' ','0',' ','0','0','NON_CTLFW','0',' ',' ', '' );

INSERT INTO DB_WRK.PRODUCT 

VALUES

(

'AU29580800000','LDGR ','15775','2014-04-28','9999-12-31',' ','3550822',' ',' ','0',' ','0','0','NON_CTLFW','0',' ',' ',' ' );

INSERT INTO DB_WRK.PRODUCT 

VALUES

(

'AU53110397555','CNTR ','1422','2007-08-30','9999-12-31','3534','674824',' ',' ','0',' ','0','0','NON_CTLFW','0',' ',' ',' ' );

INSERT INTO DB_WRK.PRODUCT 

VALUES

(

'AU18152616666','LDGR ','346','2015-11-06','9999-12-31','2067','4510692',' ',' ','0',' ','0','0','NON_CTLFW','0',' ',' ',' ' );

 

 

 

  CREATE TABLE  DB_WRK.PRODUCT_STG  (

ACCOUNT_ID VARCHAR ( 100 )

,DEPT_ROLE_C VARCHAR ( 100 )

,DEPT_I VARCHAR ( 100 )

,BRCH_N VARCHAR ( 100 )

);

 

INSERT INTO  DB_WRK.PRODUCT_STG

VALUES ( 'AU13907300233' , 'LDGR' , '15773' , '2257' );

 

INSERT INTO  DB_WRK.PRODUCT_STG

VALUES ( 'AU29214000008' , 'LDGR' , '15660' , '5502' );

 

INSERT INTO  DB_WRK.PRODUCT_STG

VALUES ( 'AU29580800054' , 'LDGR' , '15775' , '6027' );

 

INSERT INTO  DB_WRK.PRODUCT_STG

VALUES ( 'AU53110397555' , 'LDGR' , '1422' , '3534' );

 

INSERT INTO  DB_WRK.PRODUCT_STG

VALUES ( 'AU18152616666' , 'LDGR' , '12346' , '2167' );

 

INSERT INTO  DB_WRK.PRODUCT_STG

VALUES ( 'AU29580800000' , 'LDGR' , '15775' , ' ' );

 

DELETE FROM DB_WRK.PRODUCT_STG  WHERE (  ACCOUNT_ID , DEPT_ROLE_C , DEPT_I , BRCH_N ) IN

(

SEL ACCOUNT_ID , DEPT_ROLE_C , DEPT_I , BRCH_N FROM DB_WRK.PRODUCT ) ;

 

UPDATE A

FROM DB_WRK.PRODUCT A

, DB_WRK.PRODUCT_STG B

SET EXPY_D = CURRENT_DATE -1

WHERE A.ACCOUNT_ID = B.ACCOUNT_ID

AND A.DEPT_ROLE_C = B.DEPT_ROLE_C

AND A.EXPY_D = '9999-12-31' ;

 

INSERT INTO DB_WRK.PRODUCT

SEL

A.ACCOUNT_ID

,A.DEPT_ROLE_C

,A.DEPT_I

,CURRENT_DATE AS EFFT_D

,'9999-12-31' AS EXPY_D

,' ' AS BRCH_N

,' ' AS PROS_KEY_EFFT_I

,' ' AS PROS_KEY_EXPY_I

,' ' AS EROR_SEQN_I

,' ' AS ROW_SECU_ACCS_C

,' ' AS SRCE_SYST_C

,' ' AS RECORD_DELETED_FLAG

,' ' AS CTL_ID

,' ' AS PROCESS_NAME

,' ' AS PROCESS_ID

,' ' AS UPDATE_PROCESS_NAME

,' ' AS UPDATE_PROCESS_ID

,' ' AS RVNU_SHRE_R  FROM DB_WRK.PRODUCT_STG A ;

